!function(e){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.background=redux.field_objects.background||{},redux.field_objects.background.init=function(i,r){r||(r=!1),i||(i=e(document).find(".redux-group-tab:visible").find(".redux-container-background:visible")),e(i).each(function(){var i=e(this),t=i;if(i.hasClass("redux-field-container")||(t=i.parents(".redux-field-container:first")),(r||!t.is(":hidden"))&&t.hasClass("redux-field-init")){t.removeClass("redux-field-init"),i.find(".redux-remove-background").unbind("click").on("click",function(i){return i.preventDefault(),redux.field_objects.background.removeImage(e(this).parents(".redux-container-background:first")),!1}),i.find(".redux-background-upload").unbind().on("click",function(i){redux.field_objects.background.addImage(i,e(this).parents(".redux-container-background:first"))}),i.find(".redux-background-input").on("change",function(){redux.field_objects.background.preview(e(this))}),i.find(".redux-color").wpColorPicker({change:function(i,r){e(this).val(r.color.toString()),redux_change(e(this)),e("#"+i.target.id+"-transparency").removeAttr("checked"),redux.field_objects.background.preview(e(this))},clear:function(i,r){e(this).val(r.color.toString()),redux_change(e(this).parent().find(".redux-color-init")),redux.field_objects.background.preview(e(this))}}),i.find(".redux-color").on("blur",function(){var r=e(this).val(),t="#"+e(this).attr("id");"transparent"===r?(e(this).parent().parent().find(".wp-color-result").css("background-color","transparent"),i.find(t+"-transparency").attr("checked","checked")):(colorValidate(this)===r&&0!==r.indexOf("#")&&e(this).val(e(this).data("oldcolor")),i.find(t+"-transparency").removeAttr("checked"))}),i.find(".redux-color").on("focus",function(){e(this).data("oldcolor",e(this).val())}),i.find(".redux-color").on("keyup",function(){var r=e(this).val(),t=colorValidate(this),d="#"+e(this).attr("id");"transparent"===r?(e(this).parent().parent().find(".wp-color-result").css("background-color","transparent"),i.find(d+"-transparency").attr("checked","checked")):(i.find(d+"-transparency").removeAttr("checked"),t&&t!==e(this).val()&&e(this).val(t))}),i.find(".color-transparency").on("click",function(){if(e(this).is(":checked"))i.find(".redux-saved-color").val(e("#"+e(this).data("id")).val()),i.find("#"+e(this).data("id")).val("transparent"),i.find("#"+e(this).data("id")).parent().parent().find(".wp-color-result").css("background-color","transparent");else if("transparent"===i.find("#"+e(this).data("id")).val()){var r=e(".redux-saved-color").val();""===r&&(r=e("#"+e(this).data("id")).data("default-color")),i.find("#"+e(this).data("id")).parent().parent().find(".wp-color-result").css("background-color",r),i.find("#"+e(this).data("id")).val(r)}redux.field_objects.background.preview(e(this))});var d={width:"resolve",triggerChange:!0,allowClear:!0},a=i.find(".select2_params");if(a.size()>0){var n=a.val();n=JSON.parse(n),d=e.extend({},d,n)}i.find(" .redux-background-repeat, .redux-background-clip, .redux-background-origin, .redux-background-size, .redux-background-attachment, .redux-background-position").select2(d)}})},redux.field_objects.background.preview=function(i){var r=e(i).parents(".redux-container-background:first"),t=e(r).find(".background-preview");if(t){var d=!0,a="height:"+t.height()+"px;";e(r).find(".redux-background-input").each(function(){var i=e(this).serializeArray();i=i[0],i&&-1!=i.name.indexOf("[background-")&&""!==i.value&&(d=!1,i.name=i.name.split("[background-"),i.name="background-"+i.name[1].replace("]",""),a+="background-image"==i.name?i.name+':url("'+i.value+'");':i.name+":"+i.value+";")}),d?t.slideUp():t.attr("style",a).fadeIn()}},redux.field_objects.background.addImage=function(i,r){i.preventDefault();var t,d=e(this);return t?void t.open():(t=wp.media({multiple:!1,library:{},title:d.data("choose"),button:{text:d.data("update")}}),t.on("select",function(){var i=t.state().get("selection").first();if(t.close(),"image"===i.attributes.type){r.find(".upload").val(i.attributes.url),r.find(".upload-id").val(i.attributes.id),r.find(".upload-height").val(i.attributes.height),r.find(".upload-width").val(i.attributes.width),redux_change(e(r).find(".upload-id"));var d=i.attributes.url;if("undefined"!=typeof i.attributes.sizes&&"undefined"!=typeof i.attributes.sizes.thumbnail)d=i.attributes.sizes.thumbnail.url;else if("undefined"!=typeof i.attributes.sizes){var a=i.attributes.height;for(var n in i.attributes.sizes){var o=i.attributes.sizes[n];o.height<a&&(a=o.height,d=o.url)}}else d=i.attributes.icon;r.find(".upload-thumbnail").val(d),r.find(".upload").hasClass("noPreview")||r.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+d+'">').slideDown("fast"),r.find(".redux-remove-background").removeClass("hide"),r.find(".redux-background-input-properties").slideDown(),redux.field_objects.background.preview(r.find(".upload"))}}),void t.open())},redux.field_objects.background.removeImage=function(i){if(i.find(".redux-remove-background").addClass("hide")){i.find(".redux-remove-background").addClass("hide"),i.find(".upload").val(""),i.find(".upload-id").val(""),i.find(".upload-height").val(""),i.find(".upload-width").val(""),redux_change(e(i).find(".upload-id")),i.find(".redux-background-input-properties").hide();var r=i.find(".screenshot");r.slideUp(),i.find(".remove-file").unbind(),e(".section-upload .upload-notice").length>0&&e(".redux-background-upload").remove()}}}(jQuery);