!function(e){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.typography=redux.field_objects.typography||{};var t=[],r=!1,a={width:"resolve",triggerChange:!0,allowClear:!0};e(document).ready(function(){}),redux.field_objects.typography.init=function(o,p){p||(p=!1),o||(o=e(document).find(".redux-group-tab:visible").find(".redux-container-typography:visible")),e(o).each(function(){var o=e(this),s=o;if(o.hasClass("redux-field-container")||(s=o.parents(".redux-field-container:first")),(p||!s.is(":hidden"))&&s.hasClass("redux-field-init")){s.removeClass("redux-field-init");var y;o.each(function(){e(this).find(".redux-typography-container").each(function(){var t=e(this).find(".redux-typography-family");void 0===t.data("value")?t=e(this):""!==t.data("value")&&e(t).val(t.data("value"));var r=e(this).find(".select2_params");if(r.size()>0){var o=r.val();o=JSON.parse(o),a=e.extend({},a,o)}y=Boolean(e(this).find(".redux-font-clear").val()),redux.field_objects.typography.select(t),window.onbeforeunload=null}),e(this).find(".redux-typography").on("change",function(){redux.field_objects.typography.select(e(this))}),e(this).find(".redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").keyup(function(){redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))}),e(this).find(".redux-typography-color").wpColorPicker({change:function(t,r){e(this).val(r.color.toString()),redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))}}),e(this).find(".redux-typography-size").numeric({allowMinus:!1}),e(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:!0});var p=[{id:"none",text:"none"}];e(this).find(".redux-typography-family").select2({matcher:function(e,t){return 0===t.toUpperCase().indexOf(e.toUpperCase())},query:function(e){return window.Select2.query.local(p)(e)},initSelection:function(e,t){var r={id:e.val(),text:e.val()};t(r)},allowClear:y}).on("select2-opening",function(){var t=e(this).parents(".redux-container-typography:first").attr("data-id"),r=e("#"+t+" .redux-typography-font-family").data("user-fonts");r=r?1:0;var a=e("#"+t+" .redux-typography-google").val();a=a?1:0;var o=[];if(void 0!==redux.customfonts&&o.push(redux.customfonts),void 0!==redux.stdfonts&&0===r&&o.push(redux.stdfonts),1==r){var s=[];for(var y in redux.typography[t]){var i=redux.typography[t].std_font;for(var l in i)i.hasOwnProperty(l)&&s.push({id:l,text:l,"data-google":"false"})}var n={text:"Standard Fonts",children:s};o.push(n)}(1==a||a===!0&&void 0!==redux.googlefonts)&&o.push(redux.googlefonts),p=o;var d=e("#"+t+" #"+t+"-family").attr("placeholder");d||(d=null),e("#"+t+" .redux-typography-family").select2("val",d)}).on("select2-selecting",function(a){var o=a.object.text,p=e(this).parents(".redux-container-typography:first").attr("data-id");e("#"+p+" #"+p+"-family").data("value",o),e("#"+p+" #"+p+"-family").attr("placeholder",o),t=a,r=!0,redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))}).on("select2-clearing",function(){var t=e(this).parents(".redux-container-typography:first").attr("data-id");e("#"+t+" #"+t+"-family").attr("data-value",""),e("#"+t+" #"+t+"-family").attr("placeholder","Font Family"),e("#"+t+" #"+t+"-google-font").val("false"),redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))});var s=o.find(".redux-typography-family");s.hasClass("redux-typography-family")||o.find(".redux-typography-style").select2(a),o.find(".redux-typography-family-backup, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").select2(a)})}})},redux.field_objects.typography.size=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},redux.field_objects.typography.makeBool=function(e){return"false"==e||"0"==e||e===!1||0===e?!1:"true"==e||"1"==e||e===!0||1==e?!0:void 0},redux.field_objects.typography.contrastColour=function(e){var t="#444444";if(""!==e){e=e.replace("#","");var r=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16),p=(299*r+587*a+114*o)/1e3;t=p>=128?"#444444":"#ffffff"}return t},redux.field_objects.typography.select=function(o){var p=e(o).parents(".redux-container-typography:first").attr("data-id"),s=(e(o).parents(".redux-container-typography:first"),e("#"+p+" #"+p+"-family").val());s||(s=null);var y,i=e("#"+p+" select.redux-typography-family-backup").val(),l=e("#"+p+" .redux-typography-size").val(),n=e("#"+p+" .redux-typography-height").val(),d=e("#"+p+" .redux-typography-word").val(),u=e("#"+p+" .redux-typography-letter").val(),h=e("#"+p+" select.redux-typography-align").val(),g=e("#"+p+" select.redux-typography-transform").val(),c=e("#"+p+" select.redux-typography-font-variant").val(),f=e("#"+p+" select.redux-typography-decoration").val(),x=e("#"+p+" select.redux-typography-style").val(),v=e("#"+p+" select.redux-typography-subsets").val(),b=e("#"+p+" .redux-typography-color").val(),m=e("#"+p).data("units");r===!0?(y=redux.field_objects.typography.makeBool(t.object["data-google"]),e("#"+p+" .redux-typography-google-font").val(y)):y=redux.field_objects.typography.makeBool(e("#"+p+" .redux-typography-google-font").val()),e("#"+p).hasClass("typography-initialized")||(x=e("#"+p+" select.redux-typography-style").data("value"),v=e("#"+p+" select.redux-typography-subsets").data("value"),""!==x&&(x=String(x)),void 0!==typeof v&&(v=String(v))),void 0===redux.fonts.google&&(y=!1);var w="";if(w=y===!0&&s in redux.fonts.google?redux.fonts.google[s]:{400:"Normal 400",700:"Bold 700","400italic":"Normal 400 Italic","700italic":"Bold 700 Italic"},e(o).hasClass("redux-typography-subsets")&&e("#"+p+" input.typography-subsets").val(v),e(o).hasClass("redux-typography-family")){var _='<option value=""></option>';if(y===!0){var j="";e.each(w.variants,function(e,t){t.id===x||1===redux.field_objects.typography.size(w.variants)?(j=' selected="selected"',x=t.id):j="",_+='<option value="'+t.id+'"'+j+">"+t.name.replace(/\+/g," ")+"</option>"}),e("#"+p+" .redux-typography-style").select2("destroy"),e("#"+p+" .redux-typography-style").html(_),e("#"+p+" .redux-typography-style").select2(a),j="",_='<option value=""></option>',e.each(w.subsets,function(t,r){r.id===v||1===redux.field_objects.typography.size(w.subsets)?(j=' selected="selected"',v=r.id,e("#"+p+" input.typography-subsets").val(v)):j="",_+='<option value="'+r.id+'"'+j+">"+r.name.replace(/\+/g," ")+"</option>"}),e("#"+p+" .redux-typography-subsets").select2("destroy"),e("#"+p+" .redux-typography-subsets").html(_),e("#"+p+" .redux-typography-subsets").select2(a),e("#"+p+" .redux-typography-subsets").parent().fadeIn("fast"),e("#"+p+" .typography-family-backup").fadeIn("fast")}else w&&(e.each(w,function(t,r){t===x||"normal"===t?(j=' selected="selected"',e("#"+p+" .typography-style .select2-chosen").text(r)):j="",_+='<option value="'+t+'"'+j+">"+r.replace("+"," ")+"</option>"}),e("#"+p+" .redux-typography-style").select2("destroy"),e("#"+p+" .redux-typography-style").html(_),e("#"+p+" .redux-typography-style").select2(a),e("#"+p+" .redux-typography-subsets").parent().fadeOut("fast"),e("#"+p+" .typography-family-backup").fadeOut("fast"));e("#"+p+" .redux-typography-font-family").val(s)}else e(o).hasClass("redux-typography-family-backup")&&""!==i&&e("#"+p+" .redux-typography-font-family-backup").val(i);0===e("#"+p+" select.redux-typography-style option[value='"+x+"']").length?(x="",e("#"+p+" select.redux-typography-style").select2("val","")):"400"===x&&e("#"+p+" select.redux-typography-style").select2("val",x),0===e("#"+p+" select.redux-typography-subsets option[value='"+v+"']").length&&(v="",e("#"+p+" select.redux-typography-subsets").select2("val",""),e("#"+p+" input.typography-subsets").val(v));var C="style_link_"+p;if(e("."+C).remove(),null!==s&&"inherit"!==s&&e("#"+p).hasClass("typography-initialized")){var z=s.replace(/\s+/g,"+");if(y===!0){var k=z;x&&""!==x&&(k+=":"+x.replace(/\-/g," ")),v&&""!==v&&(k+="&subset="+v),"undefined"!=typeof WebFont&&WebFont&&WebFont.load({google:{families:[k]}}),e("#"+p+" .redux-typography-google").val(!0)}else e("#"+p+" .redux-typography-google").val(!1)}if(-1!==x.indexOf("italic")?(e("#"+p+" .typography-preview").css("font-style","italic"),e("#"+p+" .typography-font-style").val("italic"),x=x.replace("italic","")):(e("#"+p+" .typography-preview").css("font-style","normal"),e("#"+p+" .typography-font-style").val("")),e("#"+p+" .typography-font-weight").val(x),n||(n=l),e("#"+p+" .typography-font-size").val(""===l?"":l+m),e("#"+p+" .typography-line-height").val(""===n?"":n+m),e("#"+p+" .typography-word-spacing").val(""===d?"":d+m),e("#"+p+" .typography-letter-spacing").val(""===u?"":u+m),e("#"+p).hasClass("typography-initialized")){var I=e("#"+p+" .typography-preview").data("preview-size");"0"==I&&e("#"+p+" .typography-preview").css("font-size",l+m),e("#"+p+" .typography-preview").css("font-weight",x),e("#"+p+" .typography-preview").css("font-family",s+", sans-serif"),"none"===s&&""===s&&e("#"+p+" .typography-preview").css("font-family","inherit"),e("#"+p+" .typography-preview").css("line-height",n+m),e("#"+p+" .typography-preview").css("word-spacing",d+m),e("#"+p+" .typography-preview").css("letter-spacing",u+m),b&&(e("#"+p+" .typography-preview").css("color",b),e("#"+p+" .typography-preview").css("background-color",redux.field_objects.typography.contrastColour(b))),e("#"+p+" .typography-style .select2-chosen").text(e("#"+p+" .redux-typography-style option:selected").text()),e("#"+p+" .typography-script .select2-chosen").text(e("#"+p+" .redux-typography-subsets option:selected").text()),h&&e("#"+p+" .typography-preview").css("text-align",h),g&&e("#"+p+" .typography-preview").css("text-transform",g),c&&e("#"+p+" .typography-preview").css("font-variant",c),f&&e("#"+p+" .typography-preview").css("text-decoration",f),e("#"+p+" .typography-preview").slideDown()}e("#"+p).hasClass("typography-initialized")||e("#"+p).addClass("typography-initialized"),r=!1,redux_change(o)}}(jQuery);